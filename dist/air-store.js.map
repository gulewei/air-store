{"version":3,"file":"air-store.js","sources":["../node_modules/isarray/index.js","../node_modules/isobject/index.js","../src/utils.js","../src/unique.js","../src/store.js","../src/module.js","../src/air-store.js"],"sourcesContent":["var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","/*!\n * isobject <https://github.com/jonschlinkert/isobject>\n *\n * Copyright (c) 2014-2017, Jon Schlinkert.\n * Released under the MIT License.\n */\n\n'use strict';\n\nmodule.exports = function isObject(val) {\n  return val != null && typeof val === 'object' && Array.isArray(val) === false;\n};\n","var isarray = require('isarray')\r\nvar isobject = require('isobject')\r\n// var extend = require('extend')\r\n\r\nvar _ = {\r\n  // extend: extend,\r\n  isobj: isobject,\r\n  isfn: function (fn) {\r\n    return typeof fn === 'function'\r\n  },\r\n  noop: function () {\r\n\r\n  },\r\n  clone: function (val) {\r\n    if (isarray(val)) {\r\n      return Array.prototype.slice.call(val)\r\n    } else if (isobject(val)) {\r\n      return JSON.parse(JSON.stringify(val))\r\n    } else {\r\n      return val\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = _\r\n","var _ = require('./utils')\r\n\r\nfunction unique(value, watcher, computer) {\r\n  var _value = null\r\n  var _watcher = _.noop\r\n  var _computer = null\r\n\r\n  var unique = {\r\n    unique: true,\r\n    isComputed: false,\r\n    getComputer: function () {\r\n      return _computer\r\n    },\r\n    getValue: function () {\r\n      return _.clone(_value)\r\n    },\r\n    setValue: function (val) {\r\n      var oldVal = unique.getValue()\r\n      var newVal = _.clone(val)\r\n      _value = newVal\r\n      _watcher(newVal, oldVal)\r\n    }\r\n  }\r\n\r\n  // init wathcer\r\n  if (_.isfn(watcher)) {\r\n    _watcher = watcher\r\n  }\r\n\r\n  // init computer\r\n  if (_.isfn(computer)) {\r\n    unique.isComputed = true\r\n    _computer = computer\r\n  } \r\n\r\n  // init value\r\n  unique.setValue(value)\r\n\r\n  return unique\r\n}\r\n\r\nmodule.exports = unique\r\n","var _ = require('./utils')\r\nvar unique = require('./unique')\r\n\r\nfunction store(properties) {\r\n  var _store = {}\r\n\r\n  // check arguments\r\n  if (!_.isobj(properties)) {\r\n    return console.error('Air can only initialize key-value pires')\r\n  }\r\n\r\n  // init\r\n  var param = null\r\n  for (var key in properties) {\r\n    param = properties[key]\r\n    _store[key] = unique(param.value, param.watcher, param.computer)\r\n  }\r\n\r\n  var getContext = function () {\r\n    var context = {}\r\n    for (var name in _store) {\r\n      context[name] = _store[name].getValue()\r\n    }\r\n    return context\r\n  }\r\n\r\n  // return methods\r\n  return {\r\n    get: function (name) {\r\n      var item = _store[name]\r\n      if (item.isComputed) {\r\n        var getter = item.getComputer()\r\n        var context = getContext()\r\n        var val = getter.call(undefined, context)\r\n        item.setValue(val)\r\n      }\r\n      return item.getValue()\r\n    },\r\n    set: function (name, val) {\r\n      // uninitialized property\r\n      var item = _store[name]\r\n      if (!item || !item.unique) {\r\n        return console.error('uninitialized property \"%s\" can not be set', name)\r\n      }\r\n\r\n      // computed property\r\n      if (item.isComputed) {\r\n        return console.warn('set computed property \"%s\" only does nothing')\r\n      }\r\n\r\n      // set new value\r\n      item.setValue(val)\r\n    }\r\n  }\r\n}\r\n\r\nmodule.exports = store\r\n","var _ = require('./utils')\r\nvar store = require('./store')\r\n\r\nfunction structureProps(properties) {\r\n  var _props = {}\r\n\r\n  var data = properties.data\r\n  for (var key in data) {\r\n    _props[key] = {\r\n      value: data[key]\r\n    }\r\n  }\r\n\r\n  var computed = properties.computed\r\n  for (var k_0 in computed) {\r\n    if (_props[k_0]) {\r\n      _props[k_0].computer = computed[k_0]\r\n    } else {\r\n      _props[k_0] = {\r\n        computer: computed[k_0]\r\n      }\r\n    }\r\n  }\r\n\r\n  var watcher = properties.watcher\r\n  for (var k_1 in watcher) {\r\n    if (_props[k_1]) {\r\n      _props[k_1].watcher = watcher[k_1]\r\n    } else {\r\n      _props[k_1] = {\r\n        watcher: watcher[k_1]\r\n      }\r\n    }\r\n  }\r\n\r\n  return _props\r\n}\r\n\r\nfunction createModule(initVals) {\r\n  var _props = structureProps(initVals)\r\n  var _store = store(_props)\r\n\r\n  function air(properties, action) {\r\n    // update module\r\n    for (var key in properties) {\r\n      _store.set(key, properties[key])\r\n    }\r\n    // call action\r\n    if (_.isfn(action)) {\r\n      action.call(undefined, air)\r\n    }\r\n  }\r\n\r\n  for (var key in _props) {\r\n    (function (k_0) {\r\n      Object.defineProperty(air, key, {\r\n        get: function () {\r\n          return _store.get(k_0)\r\n        },\r\n        set: function () {\r\n          console.error('can not resign value of Air properties')\r\n        }\r\n      })\r\n    })(key)\r\n  }\r\n\r\n  return air\r\n}\r\n\r\nmodule.exports = createModule\r\n","var createModule = require('./module')\r\n\r\nvar _modules = {}\r\n\r\nfunction initialModule(name, properties) {\r\n  _modules[name] = createModule(properties)\r\n}\r\n\r\nfunction getModule(name) {\r\n  if (_modules[name] === undefined) {\r\n    return console.error('module \"%s\" has not been initialized')\r\n  } else {\r\n    return _modules[name]\r\n  }\r\n}\r\n\r\nfunction Air(name, properties) {\r\n  if (arguments.length > 1) {\r\n    initialModule(name, properties)\r\n  }\r\n\r\n  return getModule(name)\r\n}\r\n\r\n// Air.action = function (module, actMap) {\r\n//   // return function (value) {\r\n//   //   module({[name]: value}, action)\r\n//   // }\r\n// }\r\n\r\n\r\nmodule.exports = Air\r\n"],"names":["isobject","isarray","_","unique","store","createModule"],"mappings":"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"}